<h1>Messages</h1>

<div id="messages">
    {{#if msgs}}
    {{#each msgs as |msg|}}
    <div class="msg">
        <p>{{msg.msg}}</p>
        <span>{{msg.createdAt}}</span>
    </div>
    {{/each}}
    {{/if}}
</div>

<br>
<br>
<br>
<br>
<br>
<br>

<form id="msgForm">
    <input id="text-input" type="text" name="msg">
    <input id="input-username" type="text" value="{{username}}" class="hidden">
    <button id="btn-send" class="emit-notification">Send</button>
</form>

<script>
    const btnSendMsg = document.getElementById('btn-send');
    const usernameInput = document.getElementById('input-username');
    const username = usernameInput.value;

    const receiverUsername = `${username}`;
    senderUsername = '{{currentUser.username}}';
    const messages = document.getElementById('messages');
    const msgForm = document.getElementById('msgForm');

    btnSendMsg.addEventListener('click', (e) => {
        e.preventDefault()
        const textInput = document.getElementById('text-input').value;

        const options = {
            method: 'post',
            url: `/message/${username}`,
            data: {
                msg: textInput,
            }
        };

        axios(options)
            .then(response => {
                socket.emit('chatmessage', msgForm.msg.value, receiverUsername);
                msgForm.msg.value = '';
            })
            .catch(error => console.log('Error!', error))
    });
</script>